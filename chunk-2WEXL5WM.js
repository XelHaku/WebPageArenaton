import{M as A,Pa as R,U as M,V as u,a as b,b as p,c as L,ga as k,p as g,w as x,x as $}from"./chunk-AFRWPTJ3.js";import{l as w}from"./chunk-DDVT2JBD.js";var l=class extends p{constructor({callbackSelector:e,cause:r,data:d,extraData:o,sender:f,urls:n}){super(r.shortMessage||"An error occurred while fetching for an offchain result.",{cause:r,metaMessages:[...r.metaMessages||[],r.metaMessages?.length?"":[],"Offchain Gateway Call:",n&&["  Gateway URL(s):",...n.map(c=>`    ${b(c)}`)],`  Sender: ${f}`,`  Data: ${d}`,`  Callback selector: ${e}`,`  Extra data: ${o}`].flat()}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"OffchainLookupError"})}},m=class extends p{constructor({result:e,url:r}){super("Offchain gateway response is malformed. Response data must be a hex value.",{metaMessages:[`Gateway URL: ${b(r)}`,`Response: ${u(e)}`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"OffchainLookupResponseMalformedError"})}},h=class extends p{constructor({sender:e,to:r}){super("Reverted sender address does not match target contract address (`to`).",{metaMessages:[`Contract address: ${r}`,`OffchainLookup sender address: ${e}`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"OffchainLookupSenderMismatchError"})}};function S(a,e){if(!x(a))throw new g({address:a});if(!x(e))throw new g({address:e});return a.toLowerCase()===e.toLowerCase()}var Q="0x556f1830",C={name:"OffchainLookup",type:"error",inputs:[{name:"sender",type:"address"},{name:"urls",type:"string[]"},{name:"callData",type:"bytes"},{name:"callbackFunction",type:"bytes4"},{name:"extraData",type:"bytes"}]};function V(f,n){return w(this,arguments,function*(a,{blockNumber:e,blockTag:r,data:d,to:o}){let{args:c}=M({data:d,abi:[C]}),[i,t,s,O,E]=c;try{if(!S(o,i))throw new h({sender:i,to:o});let y=yield P({data:s,sender:i,urls:t}),{data:v}=yield R(a,{blockNumber:e,blockTag:r,data:$([O,A([{type:"bytes"},{type:"bytes"}],[y,E])]),to:o});return v}catch(y){throw new l({callbackSelector:O,cause:y,data:d,extraData:E,sender:i,urls:t})}})}function P(d){return w(this,arguments,function*({data:a,sender:e,urls:r}){let o=new Error("An unknown error occurred.");for(let f=0;f<r.length;f++){let n=r[f],c=n.includes("{data}")?"GET":"POST",i=c==="POST"?{data:a,sender:e}:void 0;try{let t=yield fetch(n.replace("{sender}",e).replace("{data}",a),{body:JSON.stringify(i),method:c}),s;if(t.headers.get("Content-Type")?.startsWith("application/json")?s=(yield t.json()).data:s=yield t.text(),!t.ok){o=new k({body:i,details:s?.error?u(s.error):t.statusText,headers:t.headers,status:t.status,url:n});continue}if(!L(s)){o=new m({result:s,url:n});continue}return s}catch(t){o=new k({body:i,details:t.message,url:n})}}throw o})}export{Q as a,C as b,V as c,P as d};
