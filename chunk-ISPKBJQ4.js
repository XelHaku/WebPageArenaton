import{D as z,Ga as R,Ia as O,Ja as K,K as N,Ka as $,La as _,Na as b,P as x,Pa as Y,Q as q,b as v,c as S,ca as G,da as T,e as W,ea as Q,f as g,fa as V,g as U,j as Z,k as w,oa as X,x as J}from"./chunk-AFRWPTJ3.js";import{a as k,d as M,l as u}from"./chunk-DDVT2JBD.js";function D(e){if(e.length!==66||e.indexOf("[")!==0||e.indexOf("]")!==65)return null;let r=`0x${e.slice(1,65)}`;return S(r)?r:null}function E(e){let r=new Uint8Array(32).fill(0);if(!e)return U(r);let o=e.split(".");for(let t=o.length-1;t>=0;t-=1){let n=D(o[t]),s=n?Z(n):N(w(o[t]),"bytes");r=N(J([r,s]),"bytes")}return U(r)}function ee(e){let r=new Uint8Array(32).fill(0);return e?D(e)||N(w(e)):U(r)}function C(e,r){if(!(e instanceof v))return!1;let o=e.walk(t=>t instanceof T);return o instanceof T?!!(o.data?.errorName==="ResolverNotFound"||o.data?.errorName==="ResolverWildcardNotSupported"||o.reason?.includes("Wildcard on non-extended resolvers is not supported")||r==="reverse"&&o.reason===q[50]):!1}function re(e){return`[${e.slice(2)}]`}function y(e){let r=e.replace(/^\.|\.$/gm,"");if(r.length===0)return new Uint8Array(1);let o=new Uint8Array(w(r).byteLength+2),t=0,n=r.split(".");for(let s=0;s<n.length;s++){let d=w(n[s]);d.byteLength>255&&(d=w(re(ee(n[s])))),o[t]=d.length,o.set(d,t+1),t+=d.length+1}return o.byteLength!==t+1?o.slice(0,t+1):o}function l(e,r,o){return t=>e[r.name||o]?.(t)??r(e,t)}var ue=3;function te(e,{abi:r,address:o,args:t,docsPath:n,functionName:s,sender:d}){let{code:c,data:a,message:i,shortMessage:f}=e instanceof V?e:e instanceof v?e.walk(h=>"data"in h)||e.walk():{},m=(()=>e instanceof z?new Q({functionName:s}):[ue,X.code].includes(c)&&(a||i||f)?new T({abi:r,data:typeof a=="object"?a.data:a,functionName:s,message:f??i}):e)();return new G(m,{abi:r,args:t,contractAddress:o,docsPath:n,functionName:s,sender:d})}function p(e,d){return u(this,null,function*(){var c=d,{abi:r,address:o,args:t,functionName:n}=c,s=M(c,["abi","address","args","functionName"]);let a=x({abi:r,args:t,functionName:n});try{let{data:i}=yield l(e,Y,"call")(k({data:a,to:o},s));return R({abi:r,args:t,functionName:n,data:i||"0x"})}catch(i){throw te(i,{abi:r,address:o,args:t,docsPath:"/docs/contract/readContract",functionName:n})}})}function cr(d,c){return u(this,arguments,function*(e,{blockNumber:r,blockTag:o,coinType:t,name:n,universalResolverAddress:s}){let a=s;if(!a){if(!e.chain)throw new Error("client chain not configured. universalResolverAddress is required.");a=b({blockNumber:r,chain:e.chain,contract:"ensUniversalResolver"})}try{let i=x(k({abi:_,functionName:"addr"},t!=null?{args:[E(n),BigInt(t)]}:{args:[E(n)]})),f=yield l(e,p,"readContract")({address:a,abi:O,functionName:"resolve",args:[g(y(n)),i],blockNumber:r,blockTag:o});if(f[0]==="0x")return null;let m=R({abi:_,args:t!=null?[E(n),BigInt(t)]:void 0,functionName:"addr",data:f[0]});return m==="0x"||W(m)==="0x00"?null:m}catch(i){if(C(i,"resolve"))return null;throw i}})}function oe(d,c){return u(this,arguments,function*(e,{blockNumber:r,blockTag:o,name:t,key:n,universalResolverAddress:s}){let a=s;if(!a){if(!e.chain)throw new Error("client chain not configured. universalResolverAddress is required.");a=b({blockNumber:r,chain:e.chain,contract:"ensUniversalResolver"})}try{let i=yield l(e,p,"readContract")({address:a,abi:O,functionName:"resolve",args:[g(y(t)),x({abi:$,functionName:"text",args:[E(t),n]})],blockNumber:r,blockTag:o});if(i[0]==="0x")return null;let f=R({abi:$,functionName:"text",data:i[0]});return f===""?null:f}catch(i){if(C(i,"resolve"))return null;throw i}})}var B=class extends v{constructor({data:r}){super("Unable to extract image from metadata. The metadata may be malformed or invalid.",{metaMessages:["- Metadata must be a JSON object with at least an `image`, `image_url` or `image_data` property.","",`Provided data: ${JSON.stringify(r)}`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"EnsAvatarInvalidMetadataError"})}},A=class extends v{constructor({reason:r}){super(`ENS NFT avatar URI is invalid. ${r}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"EnsAvatarInvalidNftUriError"})}},I=class extends v{constructor({uri:r}){super(`Unable to resolve ENS avatar URI "${r}". The URI may be malformed, invalid, or does not respond with a valid image.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"EnsAvatarUriResolutionError"})}},F=class extends v{constructor({namespace:r}){super(`ENS NFT avatar namespace "${r}" is not supported. Must be "erc721" or "erc1155".`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"EnsAvatarUnsupportedNamespaceError"})}};var fe=/(?<protocol>https?:\/\/[^\/]*|ipfs:\/|ipns:\/|ar:\/)?(?<root>\/)?(?<subpath>ipfs\/|ipns\/)?(?<target>[\w\-.]+)(?<subtarget>\/.*)?/,de=/^(Qm[1-9A-HJ-NP-Za-km-z]{44,}|b[A-Za-z2-7]{58,}|B[A-Z2-7]{58,}|z[1-9A-HJ-NP-Za-km-z]{48,}|F[0-9A-F]{50,})(\/(?<target>[\w\-.]+))?(?<subtarget>\/.*)?$/,le=/^data:([a-zA-Z\-/+]*);base64,([^"].*)/,pe=/^data:([a-zA-Z\-/+]*)?(;[a-zA-Z0-9].*?)?(,)/;function me(e){return u(this,null,function*(){try{let r=yield fetch(e,{method:"HEAD"});return r.status===200?r.headers.get("content-type")?.startsWith("image/"):!1}catch(r){return typeof r=="object"&&typeof r.response<"u"||!globalThis.hasOwnProperty("Image")?!1:new Promise(o=>{let t=new Image;t.onload=()=>{o(!0)},t.onerror=()=>{o(!1)},t.src=e})}})}function ne(e,r){return e?e.endsWith("/")?e.slice(0,-1):e:r}function P({uri:e,gatewayUrls:r}){let o=le.test(e);if(o)return{uri:e,isOnChain:!0,isEncoded:o};let t=ne(r?.ipfs,"https://ipfs.io"),n=ne(r?.arweave,"https://arweave.net"),s=e.match(fe),{protocol:d,subpath:c,target:a,subtarget:i=""}=s?.groups||{},f=d==="ipns:/"||c==="ipns/",m=d==="ipfs:/"||c==="ipfs/"||de.test(e);if(e.startsWith("http")&&!f&&!m){let H=e;return r?.arweave&&(H=e.replace(/https:\/\/arweave.net/g,r?.arweave)),{uri:H,isOnChain:!1,isEncoded:!1}}if((f||m)&&a)return{uri:`${t}/${f?"ipns":"ipfs"}/${a}${i}`,isOnChain:!1,isEncoded:!1};if(d==="ar:/"&&a)return{uri:`${n}/${a}${i||""}`,isOnChain:!1,isEncoded:!1};let h=e.replace(pe,"");if(h.startsWith("<svg")&&(h=`data:image/svg+xml;base64,${btoa(h)}`),h.startsWith("data:")||h.startsWith("{"))return{uri:h,isOnChain:!0,isEncoded:!1};throw new I({uri:e})}function j(e){if(typeof e!="object"||!("image"in e)&&!("image_url"in e)&&!("image_data"in e))throw new B({data:e});return e.image||e.image_url||e.image_data}function ae(o){return u(this,arguments,function*({gatewayUrls:e,uri:r}){try{let t=yield fetch(r).then(s=>s.json());return yield L({gatewayUrls:e,uri:j(t)})}catch{throw new I({uri:r})}})}function L(o){return u(this,arguments,function*({gatewayUrls:e,uri:r}){let{uri:t,isOnChain:n}=P({uri:r,gatewayUrls:e});if(n||(yield me(t)))return t;throw new I({uri:r})})}function se(e){let r=e;r.startsWith("did:nft:")&&(r=r.replace("did:nft:","").replace(/_/g,"/"));let[o,t,n]=r.split("/"),[s,d]=o.split(":"),[c,a]=t.split(":");if(!s||s.toLowerCase()!=="eip155")throw new A({reason:"Only EIP-155 supported"});if(!d)throw new A({reason:"Chain ID not found"});if(!a)throw new A({reason:"Contract address not found"});if(!n)throw new A({reason:"Token ID not found"});if(!c)throw new A({reason:"ERC namespace not found"});return{chainID:parseInt(d),namespace:c.toLowerCase(),contractAddress:a,tokenID:n}}function ie(o,t){return u(this,arguments,function*(e,{nft:r}){if(r.namespace==="erc721")return p(e,{address:r.contractAddress,abi:[{name:"tokenURI",type:"function",stateMutability:"view",inputs:[{name:"tokenId",type:"uint256"}],outputs:[{name:"",type:"string"}]}],functionName:"tokenURI",args:[BigInt(r.tokenID)]});if(r.namespace==="erc1155")return p(e,{address:r.contractAddress,abi:[{name:"uri",type:"function",stateMutability:"view",inputs:[{name:"_id",type:"uint256"}],outputs:[{name:"",type:"string"}]}],functionName:"uri",args:[BigInt(r.tokenID)]});throw new F({namespace:r.namespace})})}function ce(t,n){return u(this,arguments,function*(e,{gatewayUrls:r,record:o}){return/eip155:/i.test(o)?he(e,{gatewayUrls:r,record:o}):L({uri:o,gatewayUrls:r})})}function he(t,n){return u(this,arguments,function*(e,{gatewayUrls:r,record:o}){let s=se(o),d=yield ie(e,{nft:s}),{uri:c,isOnChain:a,isEncoded:i}=P({uri:d,gatewayUrls:r});if(a&&(c.includes("data:application/json;base64,")||c.startsWith("{"))){let m=i?atob(c.replace("data:application/json;base64,","")):c,h=JSON.parse(m);return L({uri:j(h),gatewayUrls:r})}let f=s.tokenID;return s.namespace==="erc1155"&&(f=f.replace("0x","").padStart(64,"0")),ae({gatewayUrls:r,uri:c.replace(/(?:0x)?{id}/,f)})})}function Lr(d,c){return u(this,arguments,function*(e,{blockNumber:r,blockTag:o,gatewayUrls:t,name:n,universalResolverAddress:s}){let a=yield l(e,oe,"getEnsText")({blockNumber:r,blockTag:o,key:"avatar",name:n,universalResolverAddress:s});if(!a)return null;try{return yield ce(e,{record:a,gatewayUrls:t})}catch{return null}})}function Jr(s,d){return u(this,arguments,function*(e,{address:r,blockNumber:o,blockTag:t,universalResolverAddress:n}){let c=n;if(!c){if(!e.chain)throw new Error("client chain not configured. universalResolverAddress is required.");c=b({blockNumber:o,chain:e.chain,contract:"ensUniversalResolver"})}let a=`${r.toLowerCase().substring(2)}.addr.reverse`;try{let[i,f]=yield l(e,p,"readContract")({address:c,abi:K,functionName:"reverse",args:[g(y(a))],blockNumber:o,blockTag:t});return r.toLowerCase()!==f.toLowerCase()?null:i}catch(i){if(C(i,"reverse"))return null;throw i}})}function Yr(s,d){return u(this,arguments,function*(e,{blockNumber:r,blockTag:o,name:t,universalResolverAddress:n}){let c=n;if(!c){if(!e.chain)throw new Error("client chain not configured. universalResolverAddress is required.");c=b({blockNumber:r,chain:e.chain,contract:"ensUniversalResolver"})}let[a]=yield l(e,p,"readContract")({address:c,abi:[{inputs:[{type:"bytes"}],name:"findResolver",outputs:[{type:"address"},{type:"bytes32"}],stateMutability:"view",type:"function"}],functionName:"findResolver",args:[g(y(t))],blockNumber:r,blockTag:o});return a})}export{l as a,te as b,p as c,E as d,ee as e,cr as f,oe as g,Lr as h,Jr as i,Yr as j};
